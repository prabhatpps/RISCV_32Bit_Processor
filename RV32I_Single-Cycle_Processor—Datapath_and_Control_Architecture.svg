<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="720" viewBox="0 0 1400 720" font-family="Arial, sans-serif">
  <rect width="1400" height="720" fill="white"/>

  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" font-size="16" font-weight="bold" fill="#1a1a2e">RV32I Single-Cycle Processor â€” Datapath &amp; Control Architecture</text>
  <text x="700" y="50" text-anchor="middle" font-size="10" fill="#555">Module: riscv32_singlecycle_top  |  Author: Prabhat Pandey</text>

  <!-- Stage labels -->
  <text x="80"   y="75" text-anchor="middle" font-size="9" fill="#888">[ FETCH ]</text>
  <text x="230"  y="75" text-anchor="middle" font-size="9" fill="#888">[ DECODE ]</text>
  <text x="530"  y="75" text-anchor="middle" font-size="9" fill="#888">[ EXECUTE ]</text>
  <text x="800"  y="75" text-anchor="middle" font-size="9" fill="#888">[ MEMORY ]</text>
  <text x="1050" y="75" text-anchor="middle" font-size="9" fill="#888">[ WRITEBACK ]</text>

  <!-- PC_REG -->
  <rect x="20" y="300" width="110" height="55" rx="4" fill="#eef2ff" stroke="#4361ee" stroke-width="1.5"/>
  <text x="75" y="323" text-anchor="middle" font-size="9" font-weight="bold" fill="#1a1a2e">PC_REG</text>
  <text x="75" y="337" text-anchor="middle" font-size="8" fill="#555">Program Counter</text>
  <text x="75" y="349" text-anchor="middle" font-size="8" fill="#555">[31:0]</text>

  <!-- IMEM -->
  <rect x="20" y="380" width="110" height="55" rx="4" fill="#eef2ff" stroke="#4361ee" stroke-width="1.5"/>
  <text x="75" y="403" text-anchor="middle" font-size="9" font-weight="bold" fill="#1a1a2e">IMEM</text>
  <text x="75" y="417" text-anchor="middle" font-size="8" fill="#555">Instruction</text>
  <text x="75" y="429" text-anchor="middle" font-size="8" fill="#555">Memory</text>

  <!-- DECODER / CONTROLLER -->
  <rect x="155" y="90" width="140" height="70" rx="4" fill="#fff0f3" stroke="#e63946" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="225" y="115" text-anchor="middle" font-size="9" font-weight="bold" fill="#1a1a2e">DECODER /</text>
  <text x="225" y="128" text-anchor="middle" font-size="9" font-weight="bold" fill="#1a1a2e">CONTROL UNIT</text>
  <text x="225" y="143" text-anchor="middle" font-size="8" fill="#555">Main Instruction Decoder</text>
  <text x="225" y="155" text-anchor="middle" font-size="8" fill="#555">Control Signals</text>

  <!-- ALU_CTRL -->
  <rect x="380" y="90" width="120" height="60" rx="4" fill="#fff0f3" stroke="#e63946" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="440" y="115" text-anchor="middle" font-size="9" font-weight="bold" fill="#1a1a2e">ALU_CTRL</text>
  <text x="440" y="130" text-anchor="middle" font-size="8" fill="#555">ALU Control Decoder</text>
  <text x="440" y="143" text-anchor="middle" font-size="8" fill="#555">alu_ctrl[3:0]</text>

  <!-- REGFILE -->
  <rect x="155" y="290" width="140" height="110" rx="4" fill="#eef2ff" stroke="#4361ee" stroke-width="1.5"/>
  <text x="225" y="305" text-anchor="middle" font-size="9" font-weight="bold" fill="#1a1a2e">REGFILE</text>
  <text x="225" y="327" text-anchor="middle" font-size="8" fill="#555">32x32 Register File</text>
  <text x="225" y="341" text-anchor="middle" font-size="8" fill="#555">3 Read / 1 Write</text>
  <text x="225" y="355" text-anchor="middle" font-size="8" fill="#555">rs1_val, rs2_val</text>
  <text x="225" y="369" text-anchor="middle" font-size="8" fill="#555">wb_data to rd</text>
  <text x="225" y="383" text-anchor="middle" font-size="8" fill="#555">reg_write</text>

  <!-- IMM_GEN -->
  <rect x="155" y="430" width="140" height="65" rx="4" fill="#eef2ff" stroke="#4361ee" stroke-width="1.5"/>
  <text x="225" y="455" text-anchor="middle" font-size="9" font-weight="bold" fill="#1a1a2e">IMM_GEN</text>
  <text x="225" y="469" text-anchor="middle" font-size="8" fill="#555">Immediate Generator</text>
  <text x="225" y="483" text-anchor="middle" font-size="8" fill="#555">I / S / B / U / J</text>

  <!-- MUX A -->
  <polygon points="370,295 370,340 392,328 392,307" fill="#dde1ff" stroke="#4361ee" stroke-width="1.2"/>
  <text x="373" y="316" font-size="7" fill="#333">MUX</text>
  <text x="373" y="326" font-size="7" fill="#333">A</text>

  <!-- MUX B -->
  <polygon points="370,365 370,415 392,403 392,377" fill="#dde1ff" stroke="#4361ee" stroke-width="1.2"/>
  <text x="373" y="388" font-size="7" fill="#333">MUX</text>
  <text x="373" y="398" font-size="7" fill="#333">B</text>

  <!-- ALU -->
  <polygon points="520,280 520,460 568,438 568,302" fill="#e8f4f8" stroke="#219ebc" stroke-width="1.5"/>
  <text x="542" y="354" text-anchor="middle" font-size="10" font-weight="bold" fill="#1a1a2e">ALU</text>
  <text x="542" y="373" text-anchor="middle" font-size="7.5" fill="#555">[32-bit]</text>

  <!-- BRANCH_UNIT -->
  <rect x="520" y="500" width="140" height="60" rx="4" fill="#eef2ff" stroke="#4361ee" stroke-width="1.5"/>
  <text x="590" y="524" text-anchor="middle" font-size="9" font-weight="bold" fill="#1a1a2e">BRANCH_UNIT</text>
  <text x="590" y="538" text-anchor="middle" font-size="8" fill="#555">Branch Comparator</text>
  <text x="590" y="551" text-anchor="middle" font-size="8" fill="#555">take_branch</text>

  <!-- DMEM -->
  <rect x="760" y="290" width="140" height="130" rx="4" fill="#eef2ff" stroke="#4361ee" stroke-width="1.5"/>
  <text x="800" y="315" text-anchor="middle" font-size="9" font-weight="bold" fill="#1a1a2e">DMEM</text>
  <text x="800" y="335" text-anchor="middle" font-size="8" fill="#555">Data Memory</text>
  <text x="800" y="350" text-anchor="middle" font-size="8" fill="#555">(Load / Store)</text>
  <text x="800" y="367" text-anchor="middle" font-size="8" fill="#555">mem_read</text>
  <text x="800" y="381" text-anchor="middle" font-size="8" fill="#555">mem_write</text>
  <text x="800" y="395" text-anchor="middle" font-size="8" fill="#555">mem_data[31:0]</text>

  <!-- WB MUX -->
  <polygon points="1040,295 1040,430 1062,415 1062,310" fill="#dde1ff" stroke="#4361ee" stroke-width="1.2"/>
  <text x="1045" y="353" font-size="7" fill="#333">WB</text>
  <text x="1045" y="363" font-size="7" fill="#333">MUX</text>

  <!-- PC_NEXT_LOGIC -->
  <rect x="760" y="500" width="150" height="70" rx="4" fill="#fff0f3" stroke="#e63946" stroke-width="1.5" stroke-dasharray="5,3"/>
  <text x="835" y="526" text-anchor="middle" font-size="9" font-weight="bold" fill="#1a1a2e">PC_NEXT_LOGIC</text>
  <text x="835" y="540" text-anchor="middle" font-size="8" fill="#555">Next PC Selector</text>
  <text x="835" y="554" text-anchor="middle" font-size="8" fill="#555">PC+4/Branch/JAL/JALR</text>

  <!-- ============================================================ WIRES ============================================================ -->

  <!-- clk/rst label -->
  <text x="30" y="268" font-size="8" fill="#333">clk / rst_n</text>
  <line x1="75" y1="272" x2="75" y2="300" stroke="#333" stroke-width="1" marker-end="url(#arr)"/>

  <!-- PC_REG to IMEM -->
  <line x1="75" y1="355" x2="75" y2="380" stroke="#333" stroke-width="1.2"/>
  <text x="78" y="372" font-size="7.5" fill="#333">pc_current</text>

  <!-- IMEM to instr bus (right) -->
  <line x1="130" y1="407" x2="152" y2="407" stroke="#333" stroke-width="1.2"/>
  <!-- instr bus vertical -->
  <line x1="152" y1="200" x2="152" y2="420" stroke="#333" stroke-width="1.2"/>
  <!-- to DECODER -->
  <line x1="152" y1="145" x2="155" y2="145" stroke="#333" stroke-width="1.2"/>
  <line x1="152" y1="145" x2="152" y2="200" stroke="#333" stroke-width="1.2"/>
  <text x="105" y="185" font-size="8" fill="#333">instr[31:0]</text>
  <!-- to IMM_GEN -->
  <line x1="152" y1="407" x2="152" y2="462" stroke="#333" stroke-width="1.2"/>
  <line x1="152" y1="462" x2="155" y2="462" stroke="#333" stroke-width="1.2"/>
  <circle cx="152" cy="407" r="3" fill="#333"/>
  <circle cx="152" cy="145" r="3" fill="#333"/>

  <!-- instr to ALU_CTRL (funct3/funct7) -->
  <line x1="152" y1="200" x2="440" y2="200" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="440" y1="150" x2="440" y2="200" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="330" y="198" font-size="7.5" fill="#e63946">funct3 / funct7</text>
  <circle cx="152" cy="200" r="3" fill="#e63946"/>

  <!-- alu_op from DECODER to ALU_CTRL -->
  <line x1="295" y1="128" x2="380" y2="120" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="310" y="117" font-size="7.5" fill="#e63946">alu_op</text>

  <!-- alu_ctrl from ALU_CTRL down to ALU -->
  <line x1="440" y1="150" x2="440" y2="220" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="440" y1="220" x2="532" y2="220" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="532" y1="220" x2="532" y2="280" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="446" y="215" font-size="7.5" fill="#e63946">alu_ctrl[3:0]</text>

  <!-- rs1_val to MUX A -->
  <line x1="295" y1="330" x2="370" y2="318" stroke="#333" stroke-width="1.2"/>
  <text x="300" y="325" font-size="7.5" fill="#333">rs1_val</text>

  <!-- rs2_val to MUX B -->
  <line x1="295" y1="358" x2="370" y2="378" stroke="#333" stroke-width="1.2"/>
  <text x="300" y="370" font-size="7.5" fill="#333">rs2_val</text>
  <circle cx="295" cy="358" r="3" fill="#333"/>

  <!-- PC to MUX A top -->
  <line x1="130" y1="318" x2="370" y2="300" stroke="#333" stroke-width="1"/>
  <text x="160" y="310" font-size="7.5" fill="#555">pc_current</text>
  <circle cx="130" cy="318" r="3" fill="#333"/>

  <!-- imm to MUX B -->
  <line x1="295" y1="460" x2="370" y2="405" stroke="#333" stroke-width="1.2"/>
  <text x="298" y="448" font-size="7.5" fill="#333">imm (I/S)</text>

  <!-- use_pc_as_alu_a ctrl (dashed from decoder to MUX A sel) -->
  <line x1="295" y1="155" x2="382" y2="301" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="343" y="228" font-size="7" fill="#e63946">use_pc_as_alu_a</text>

  <!-- alu_src ctrl (dashed to MUX B sel) -->
  <line x1="295" y1="158" x2="382" y2="371" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="315" y="268" font-size="7" fill="#e63946">alu_src</text>

  <!-- MUX A out to ALU A -->
  <line x1="392" y1="317" x2="520" y2="317" stroke="#333" stroke-width="1.2"/>
  <text x="400" y="311" font-size="7.5" fill="#333">alu_in_a</text>

  <!-- MUX B out to ALU B -->
  <line x1="392" y1="390" x2="520" y2="390" stroke="#333" stroke-width="1.2"/>
  <text x="400" y="385" font-size="7.5" fill="#333">alu_in_b</text>

  <!-- ALU result to DMEM addr -->
  <line x1="568" y1="355" x2="760" y2="355" stroke="#333" stroke-width="1.2"/>
  <text x="590" y="348" font-size="7.5" fill="#333">alu_result[31:0]</text>
  <circle cx="665" cy="355" r="3" fill="#333"/>

  <!-- ALU result to WB MUX -->
  <line x1="665" y1="355" x2="665" y2="325" stroke="#333" stroke-width="1"/>
  <line x1="665" y1="325" x2="1040" y2="325" stroke="#333" stroke-width="1"/>
  <text x="680" y="320" font-size="7.5" fill="#333">alu_result</text>

  <!-- rs2_val to DMEM write_data -->
  <line x1="295" y1="358" x2="740" y2="358" stroke="#aaa" stroke-width="1"/>
  <line x1="740" y1="358" x2="740" y2="395" stroke="#aaa" stroke-width="1"/>
  <line x1="740" y1="395" x2="760" y2="395" stroke="#aaa" stroke-width="1"/>
  <text x="500" y="365" font-size="7.5" fill="#aaa">rs2_val (store)</text>

  <!-- mem_read/mem_write ctrl to DMEM -->
  <line x1="295" y1="158" x2="700" y2="158" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="700" y1="158" x2="700" y2="305" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="700" y1="305" x2="760" y2="305" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="620" y="200" font-size="7.5" fill="#e63946">mem_read / mem_write</text>

  <!-- DMEM mem_data to WB MUX -->
  <line x1="900" y1="370" x2="1040" y2="370" stroke="#333" stroke-width="1.2"/>
  <text x="918" y="365" font-size="7.5" fill="#333">mem_data</text>

  <!-- pc_plus4 to WB MUX -->
  <line x1="850" y1="500" x2="850" y2="475" stroke="#333" stroke-width="1"/>
  <line x1="850" y1="475" x2="1022" y2="475" stroke="#333" stroke-width="1"/>
  <line x1="1022" y1="475" x2="1022" y2="410" stroke="#333" stroke-width="1"/>
  <line x1="1022" y1="410" x2="1040" y2="410" stroke="#333" stroke-width="1"/>
  <text x="860" y="468" font-size="7.5" fill="#333">pc_plus4</text>

  <!-- imm_u / pc+imm_u to WB MUX -->
  <line x1="295" y1="483" x2="1032" y2="483" stroke="#aaa" stroke-width="1"/>
  <line x1="1032" y1="483" x2="1032" y2="393" stroke="#aaa" stroke-width="1"/>
  <line x1="1032" y1="393" x2="1040" y2="393" stroke="#aaa" stroke-width="1"/>
  <text x="430" y="496" font-size="7.5" fill="#aaa">imm_u / pc+imm_u</text>

  <!-- wb_sel ctrl to WB MUX -->
  <line x1="295" y1="158" x2="950" y2="158" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="950" y1="158" x2="950" y2="295" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="950" y1="295" x2="1040" y2="295" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="920" y="200" font-size="7.5" fill="#e63946">wb_sel</text>

  <!-- WB MUX to wb_data (out right) then feedback to REGFILE -->
  <line x1="1062" y1="362" x2="1120" y2="362" stroke="#333" stroke-width="1.5"/>
  <text x="1065" y="355" font-size="7.5" fill="#333">wb_data</text>
  <line x1="1120" y1="362" x2="1120" y2="248" stroke="#333" stroke-width="1.2"/>
  <line x1="1120" y1="248" x2="225" y2="248" stroke="#333" stroke-width="1.2"/>
  <line x1="225" y1="248" x2="225" y2="290" stroke="#333" stroke-width="1.2"/>
  <text x="640" y="241" text-anchor="middle" font-size="7.5" fill="#333">wb_data to REGFILE write port</text>

  <!-- reg_write ctrl to REGFILE -->
  <line x1="225" y1="160" x2="225" y2="248" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <circle cx="225" cy="248" r="3" fill="#e63946"/>
  <text x="228" y="215" font-size="7.5" fill="#e63946">reg_write</text>

  <!-- BRANCH_UNIT take_branch to PC_NEXT_LOGIC -->
  <line x1="660" y1="530" x2="760" y2="535" stroke="#333" stroke-width="1.2"/>
  <text x="668" y="524" font-size="7.5" fill="#333">take_branch</text>

  <!-- rs1/rs2 to BRANCH_UNIT -->
  <line x1="295" y1="355" x2="480" y2="355" stroke="#333" stroke-width="1"/>
  <line x1="480" y1="355" x2="480" y2="525" stroke="#333" stroke-width="1"/>
  <line x1="480" y1="525" x2="520" y2="525" stroke="#333" stroke-width="1"/>

  <!-- imm_b/j/i to PC_NEXT_LOGIC -->
  <line x1="295" y1="475" x2="695" y2="475" stroke="#333" stroke-width="1"/>
  <line x1="695" y1="475" x2="695" y2="525" stroke="#333" stroke-width="1"/>
  <line x1="695" y1="525" x2="760" y2="525" stroke="#333" stroke-width="1"/>
  <text x="390" y="468" font-size="7.5" fill="#333">imm_b / imm_j / imm_i</text>

  <!-- branch/jump/jalr ctrl to PC_NEXT_LOGIC -->
  <line x1="295" y1="158" x2="835" y2="158" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="835" y1="158" x2="835" y2="500" stroke="#e63946" stroke-width="1" stroke-dasharray="4,3"/>
  <text x="780" y="200" font-size="7.5" fill="#e63946">branch/jump/jalr</text>
  <circle cx="295" cy="158" r="3" fill="#e63946"/>

  <!-- PC_NEXT_LOGIC pc_next feedback to PC_REG -->
  <line x1="760" y1="540" x2="10" y2="540" stroke="#333" stroke-width="1.2"/>
  <line x1="10" y1="327" x2="10" y2="540" stroke="#333" stroke-width="1.2"/>
  <line x1="10" y1="327" x2="20" y2="327" stroke="#333" stroke-width="1.2"/>
  <text x="35" y="555" font-size="7.5" fill="#333">pc_next</text>

  <!-- pc_current to PC_NEXT_LOGIC (for JAL/BRANCH base) -->
  <line x1="130" y1="318" x2="140" y2="318" stroke="#aaa" stroke-width="1"/>
  <line x1="140" y1="318" x2="140" y2="610" stroke="#aaa" stroke-width="1"/>
  <line x1="140" y1="610" x2="760" y2="610" stroke="#aaa" stroke-width="1"/>
  <line x1="760" y1="610" x2="760" y2="565" stroke="#aaa" stroke-width="1"/>
  <text x="300" y="625" font-size="7.5" fill="#aaa">pc_current (JAL/AUIPC base)</text>

  <!-- ============================================================ LEGEND ============================================================ -->
  <rect x="1100" y="575" width="280" height="115" rx="4" fill="#f9f9f9" stroke="#ccc" stroke-width="1"/>
  <text x="1240" y="595" text-anchor="middle" font-size="9" font-weight="bold" fill="#333">LEGEND</text>
  <line x1="1120" y1="615" x2="1175" y2="615" stroke="#333" stroke-width="1.5"/>
  <polygon points="1175,611 1175,619 1183,615" fill="#333"/>
  <text x="1195" y="619" font-size="8" fill="#333">Data / Address signal [32-bit]</text>
  <line x1="1120" y1="640" x2="1175" y2="640" stroke="#e63946" stroke-width="1.2" stroke-dasharray="5,3"/>
  <polygon points="1175,636 1175,644 1183,640" fill="#e63946"/>
  <text x="1195" y="644" font-size="8" fill="#333">Control signal (dashed)</text>
  <circle cx="1148" cy="665" r="4" fill="#333"/>
  <text x="1195" y="669" font-size="8" fill="#333">Wire junction (T-connection)</text>

  <!-- wb_sel note -->
  <rect x="1100" y="475" width="280" height="95" rx="4" fill="#f9f9f9" stroke="#ccc" stroke-width="1"/>
  <text x="1240" y="493" text-anchor="middle" font-size="8" font-weight="bold" fill="#333">wb_sel encoding</text>
  <text x="1115" y="508" font-size="7.5" fill="#555">000  ->  ALU result</text>
  <text x="1115" y="521" font-size="7.5" fill="#555">001  ->  mem_data  (LOAD)</text>
  <text x="1115" y="534" font-size="7.5" fill="#555">010  ->  PC + 4    (JAL/JALR)</text>
  <text x="1115" y="547" font-size="7.5" fill="#555">011  ->  U-imm     (LUI)</text>
  <text x="1115" y="560" font-size="7.5" fill="#555">100  ->  PC+U-imm  (AUIPC)</text>

</svg>
